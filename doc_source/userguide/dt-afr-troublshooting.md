# Troubleshooting<a name="dt-afr-troublshooting"></a>

Each test suite execution has a unique execution ID that is used to create a folder named `results/<execution-id>` in the `results` directory\. Individual test group logs are under the `results/<execution-id>/logs` directory\. Use the IDT for FreeRTOS console output to find the execution id, test case id, and test group id of the test case that failed and then open the log file for that test case named `results/<execution-id>/logs/<test_group_id>__<test_case_id>.log`\. The information in this file includes: 
+ Full build and flash command output\.
+ Test execution output\.
+ More verbose IDT for FreeRTOS console output\.

We recommend the following workflow for troubleshooting:

1. Read the console output to find information, such as execution UUID and currently executing tasks\.

1. Look in the `AFQ_Report.xml` file for error statements from each test\. This directory contains execution logs of each test group\.

1. Look in the logs files under `/results/<execution-id>/logs`\.

1. Investigate one of the following problem areas:
   + Device configuration, such as JSON configuration files in the `/configs/` folder\.
   + Device interface\. Check the logs to determine which interface is failing\.
   + Device tooling\. Make sure that the toolchains for building and flashing the device are installed and configured correctly\.
   + Make sure that you have a clean, cloned version of the FreeRTOS source code\. FreeRTOS releases are tagged according to FreeRTOS version\. To clone a specific version of the code, use git clone \-\-branch * <version\-number>* https://github\.com/aws/amazon\-freertos\.git\.

## Troubleshooting Device Configuration<a name="troubleshoot-device-config"></a>

When you use IDT for FreeRTOS, you must get the correct configuration files in place before you execute the binary\. If you are getting parsing and configuration errors, your first step should be to locate and use a configuration template appropriate for your environment\. These templates are located in the `<IDT_ROOT>/configs` directory\.

If you are still having issues, see the following debugging process\.

### Where Do I Look?<a name="where-to-look"></a>

Start by reading the console output to find information, such as the execution UUID, which is referenced as `execution-id` in this documentation\.

Next, look in the `AFQ_Report.xml` file in the `/results/<execution-id>` directory\. This file contains all of the test cases that were run and error snippets for each failure\. To get all of the execution logs, look for the file `/results/<execution-id>/logs/<test_group_id>__<test_case_id>.log` for each test case\.

### IDT Error Codes<a name="idt-error-codes"></a>

The following table explains the error codes generated by IDT for FreeRTOS:


| Error Code | Error Code Name | Possible Root Cause | Troubleshooting | 
| --- | --- | --- | --- | 
|  201  |  InvalidInputError  |  Fields in `device.json`, `config.json`, or `userdata.json` are either missing or in an incorrect format\.  |  Make sure required fields are not missing and are in required format in listed files\. For more information, see [Preparing to Test Your Microcontroller Board for the First Time](qual-steps.md)\.   | 
|  202  |  ValidationError  |  Fields in `device.json`, `config.json`, or `userdata.json` contain invalid values\.  |  Check the error message on the right hand side of the error code in the report: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/freertos/latest/userguide/dt-afr-troublshooting.html)  | 
|  203  |  CopySourceCodeError  |  Unable to copy FreeRTOS source code to specified directory\.  |  Verify the following items: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/freertos/latest/userguide/dt-afr-troublshooting.html)  | 
|  204  |  BuildSourceError  |  Unable to compile the FreeRTOS source code\.  |  Verify the following items: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/freertos/latest/userguide/dt-afr-troublshooting.html)  | 
|  205  |  FlashOrRunTestError  |  IDT FreeRTOS is unable to flash or run FreeRTOS on your DUT\.  |  Verify the information under `flashTool` in your `userdata.json` file is correct\. For more information, see [Configure Build, Flash, and Test Settings](qual-steps.md#cfg-dt-ud)\.  | 
|  206  |  StartEchoServerError  |  IDT FreeRTOS is unable to start echo server for the WiFi or secure sockets tests\.  |  Verify the ports configured under `echoServerConfiguration` in your `userdata.json` file are not in use or blocked by firewall or network settings\.  | 

### Debugging Parsing Errors<a name="parse-error"></a>

Occasionally, a typo in a JSON configuration can lead to parsing errors\. Most of the time, the issue is a result of omitting a bracket, comma, or quote from your JSON file\. IDT for FreeRTOS performs JSON validation and prints debugging information\. It prints the line where the error occurred, the line number, and the column number of the syntax error\. This information should be enough to help you fix the error, but if you are still having issues locating the error, you can perform validation manually in your IDE, a text editor such as Atom or Sublime, or through an online tool like JSONLint\.

### Debugging Required Parameter Missing Error<a name="param-missing"></a>

Because new features are being added to IDT for FreeRTOS, changes to the configuration files might be introduced\. Using an old configuration file might break your configuration\. If this happens, the `<test_group_id>__<test_case_id>.log` file under the `results/<execution-id>/logs` directory explicitly lists all missing parameters\. IDT for FreeRTOS validates your JSON configuration file schemas to ensure that the latest supported version has been used\.

### Debugging Could Not Start Test Error<a name="could-not-start-test"></a>

You might encounter errors that point to failures during test start\. Because there are several possible causes, check the following areas for correctness:
+ Make sure that the pool name you've included in your execution command actually exists\. This is referenced directly from your `device.json` file\.
+ Make sure that the device or devices in your pool have correct configuration parameters\.

### Network Test Errors<a name="network-test-errors"></a>

For network\-based tests, IDT starts an echo server that binds to a non\-reserved port on the host machine\. If you are running into errors due to timeouts or unavailable connections in the WiFi or secure sockets tests, make sure that your network is configured to allow traffic to configured ports in the 1024 \- 49151 range\.

The secure sockets test uses ports 33333 and 33334 by default\. The WiFi tests uses port 33335 by default\. If these three ports are in use or blocked by firewall or network, you can choose to use different ports in userdata\.json for testing\. For more information, see [Configure Build, Flash, and Test Settings](qual-steps.md#cfg-dt-ud)\. You can use the following commands to check whether a specific port is in use:
+ Windows: netsh advfirewall firewall show rule name=all \| grep port
+ Linux: sudo netstat \-pan \| grep port
+ macOS: netstat \-nat \| grep port

### OTA Update Failures Due to Same Version Payload<a name="ota-update-failure"></a>

If OTA test cases are failing due to the same version being on the device after an OTA was performed, it may be due to your build system \(e\.g\. cmake\) not noticing IDT's changes to the FreeRTOS source code and not building an updated binary\. This causes OTA to be performed with the same binary that is currently on the device, and the test to fail\. To troubleshoot OTA update failures, start by making sure that you are using the latest supported version of your build system\. 

### OTA TestFailure on PresignedUrlExpired Test Case<a name="ota-test-failure"></a>

One prerequisite of this test is that the OTA update time should be more than 60 seconds, otherwise the test would fail\. If this occurs, the following error message is found in the log: "Test takes less than 60 seconds \(url expired time\) to finish\. Please reach out to us\." 

### Debugging Device Interface and Port Errors<a name="device-interface"></a>

This section contains information about the device interfaces IDT uses to connect to your devices\.

#### Supported Platforms<a name="platform-differences"></a>

IDT supports Linux, macOS, and Windows\. All three platforms have different naming schemes for serial devices that are attached to them:
+ Linux: `/dev/tty*`
+ macOS: `/dev/tty.*` or `/dev/cu.*`
+ Windows: COM\*

To check your device port:
+ For Linux/macOS, open a terminal and run ls /dev/tty\*\.
+ For macOS, open a terminal and run ls /dev/tty\.\* or ls /dev/cu\.\*\.
+ For Windows, open Device Manager and expand the serial devices group\.

To verify which device is connected to a port:
+ For Linux, make sure that the `udev` package is installed, and then run udevadm info â€“name=*<PORT>*\. This utility prints the device driver information that helps you verify you are using the correct port\. 
+ For macOS, open Launchpad and search for **System Information**\.
+ For Windows, open Device Manager and expand the serial devices group\.

#### Device Interfaces<a name="device-interfaces"></a>

Each embedded device is different, which means that they can have one or more serial ports\. It is common for devices to have two ports when connected to a machine:
+ A data port for flashing the device\.
+ A read port to read output\.

  You must set the correct read port in your `device.json` file\. Otherwise, reading output from the device might fail\.

  In the case of multiple ports, make sure to use the read port of the device in your `device.json` file\. For example, if you plug in an Espressif WRover device and the two ports assigned to it are `/dev/ttyUSB0` and `/dev/ttyUSB1`, use `/dev/ttyUSB1` in your `device.json` file\.

  For Windows, follow the same logic\.

#### Reading Device Data<a name="reading-device-data"></a>

IDT for FreeRTOS uses individual device build and flash tooling to specify port configuration\. If you are testing your device and don't get output, try the following default settings:
+ Baud rate: 115200
+ Data bits: 8
+ Parity: None
+ Stop bits: 1
+ Flow control: None

These settings are handled by IDT for FreeRTOS\. You do not have to set them\. However, you can use the same method to manually read device output\. On Linux or macOS, you can do this with the screen command\. On Windows, you can use a program such as TeraTerm\.

`Screen: screen /dev/cu.usbserial 115200`

`TeraTerm: Use the above-provided settings to set the fields explicitly in the GUI.`

### Development Toolchain Problems<a name="dev-toolchain"></a>

This section discusses problems that can occur with your toolchain\.

#### Code Composer Studio on Ubuntu<a name="ccs-ubuntu"></a>

Newer versions of Ubuntu \(17\.10 and 18\.04\) have a version of the `glibc` package that is not compatible with Code Composer Studio 7\.*x* versions\. We recommended that you install Code Composer Studio version 8\.2 or later\.

Symptoms of incompatibility might include:
+ FreeRTOS failing to build or flash to your device\.
+ The Code Composer Studio installer might freeze\.
+ No log output is displayed in the console during the build or flash process\.
+ Build command attempts to launch in GUI mode even when invoked as headless\.

### Logging<a name="dt-logging"></a>

IDT for FreeRTOS logs are placed in a single location\. From the root IDT directory, these files are available under `results/<execution-id>/`:
+ `AFQ_Report.xml`
+ `awsiotdevicetester_report.xml`
+ `logs/<test_group_id>__<test_case_id>.log`

`AFQ_Report.xml` and `logs/<test_group_id>__<test_case_id>.log` are the most important logs to examine\. `AFQ_Report.xml` contains information about which test cases failed with a specific error message\. You can then use `logs/<test_group_id>__<test_case_id>.log` to dig further into the problem to get better context\. 

#### Console Errors<a name="err-console"></a>

When AWS IoT Device Tester is run, failures are reported to the console with brief messages\. Look in `results/<execution-id>/logs/<test_group_id>__<test_case_id>.log` to learn more about the error\.

#### Log Errors<a name="err-log"></a>

Each test suite execution has a unique execution ID that is used to create a folder named `results/<execution-id>`\. Individual test case logs are under the `results/<execution-id>/logs` directory\. Use the output of the IDT for FreeRTOS console to find the execution id, test case id, and test group id of the test case that failed\. Then use this information to find and open the log file for that test case named `results/<execution-id>/logs/<test_group_id>__<test_case_id>.log` The information in this file includes the full build and flash command output, test execution output, and more verbose AWS IoT Device Tester console output\.

## Troubleshooting Timeout Errors<a name="troubleshoot-timeout"></a>

If you encounter timeout errors while running a test suite, increase the timeout by specifying a timeout multiplier factor\. This factor is applied to the default timeout value\. Any value configured for this flag must be greater than or equal to 1\.0\. To use the timeout multiplier, use the flag `--timeout-multiplier` when running the test suite\. For example:

\./devicetester\_linux run\-suite \-\-suite\-id AFQ\_1 \-\-pool\-id DevicePool1 \-\-timeout\-multiplier 2\.5